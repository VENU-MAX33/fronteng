<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Match Details - Sports Arena Hub</title>
  <link rel="stylesheet" href="../style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">
</head>

<body>

  <header>
    <div class="container">
      <nav>
        <div class="logo">
          <div class="logo-icon">üèÜ</div>
          Sports Arena Hub
        </div>
        <div class="nav-links">
          <a href="index.html">Home</a>
          <a href="register.html">Register Team</a>
          <a href="live_score.html" class="active">Live Matches</a>
          <a href="achievements.html">Achievements</a>
          <a href="admin.html">üéÆ Host Match</a>
        </div>
      </nav>
    </div>
  </header>

  <section class="container" style="padding-top: 2rem;">
    <a href="live_score.html" style="color: var(--accent);"><i class="fas fa-arrow-left"></i> Back to Matches</a>

    <div id="matchDetails" style="margin-top: 2rem;">
      <div class="text-center" style="padding: 3rem;">
        <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: var(--text-light);"></i>
        <p style="margin-top: 1rem; color: var(--text-light);">Loading match details...</p>
      </div>
    </div>
  </section>

  <footer>
    <div class="container">
      <p>üèÜ Sports Arena Hub</p>
    </div>
  </footer>

  <script src="../js/config.js"></script>
  <script src="../js/auth.js"></script>
  <script>
    let matchId = '';
    let matchData = null;

    document.addEventListener('DOMContentLoaded', async () => {
      if (typeof updateNavAuth === 'function') updateNavAuth();

      const params = new URLSearchParams(window.location.search);
      matchId = params.get('id');

      if (matchId) {
        await loadMatchDetails();
      } else {
        document.getElementById('matchDetails').innerHTML = `
          <div class="text-center" style="padding: 3rem;">
            <p style="color: var(--accent);">Match not found</p>
            <a href="live_score.html" class="btn" style="margin-top: 1rem;">View All Matches</a>
          </div>
        `;
      }
    });

    async function loadMatchDetails() {
      try {
        const response = await fetch(`${API_BASE_URL}/api/matches/${matchId}`);

        if (response.ok) {
          matchData = await response.json();
          renderMatch();
        } else {
          throw new Error('Match not found');
        }
      } catch (error) {
        console.error('Error loading match:', error);
        document.getElementById('matchDetails').innerHTML = `
          <div class="text-center" style="padding: 3rem;">
            <p style="color: var(--accent);">Error loading match details</p>
            <a href="live_score.html" class="btn" style="margin-top: 1rem;">View All Matches</a>
          </div>
        `;
      }
    }

    function renderMatch() {
      if (!matchData) return;

      const container = document.getElementById('matchDetails');
      const sport = matchData.sport || 'cricket';
      const isLive = matchData.status === 'live';

      let html = `
        <div class="scoreboard ${sport}" style="margin-bottom: 2rem;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <span class="match-badge badge-${sport}">${capitalize(sport)}</span>
            <span class="match-badge ${isLive ? 'badge-live' : 'badge-completed'}">
              ${isLive ? 'üî¥ Live' : '‚úÖ Completed'}
            </span>
          </div>
          ${renderScoreDisplay(matchData)}
        </div>
      `;

      // Toss details
      if (matchData.toss) {
        html += `
          <div style="background: white; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem; box-shadow: var(--shadow-sm);">
            <h3 style="margin-bottom: 1rem;"><i class="fas fa-coins"></i> Toss</h3>
            <p><strong>${matchData.toss.winner}</strong> won the toss and chose to <strong>${matchData.toss.choice}</strong></p>
          </div>
        `;
      }

      // Match result
      if (matchData.result) {
        html += `
          <div style="background: linear-gradient(135deg, var(--${sport}-primary) 0%, var(--${sport}-light, #333) 100%); color: white; border-radius: 12px; padding: 2rem; margin-bottom: 2rem; text-align: center;">
            <h2 style="margin: 0;">üèÜ ${matchData.result}</h2>
          </div>
        `;
      }

      // Sport-specific details
      if (sport === 'cricket') {
        html += renderCricketDetails();
      } else if (sport === 'kabaddi') {
        html += renderKabaddiDetails();
      } else {
        html += renderVolleyballDetails();
      }

      container.innerHTML = html;
    }

    function renderScoreDisplay(match) {
      const sport = match.sport || 'cricket';

      if (sport === 'cricket') {
        return `
          <div style="text-align: center;">
            <div class="teams-display">
              ${match.team1_name || match.team1} vs ${match.team2_name || match.team2}
            </div>
            <div class="score-big">${match.runs || 0}/${match.wickets || 0}</div>
            <div style="opacity: 0.8;">Overs: ${match.overs || '0.0'} / ${match.total_overs || 'N/A'}</div>
          </div>
        `;
      } else {
        return `
          <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 2rem; align-items: center; text-align: center;">
            <div>
              <div style="font-size: 1.1rem; opacity: 0.8;">${match.team1_name || match.team1}</div>
              <div class="score-big" style="font-size: 4rem;">${match.team1_score || 0}</div>
            </div>
            <div style="font-size: 1.5rem; opacity: 0.5;">VS</div>
            <div>
              <div style="font-size: 1.1rem; opacity: 0.8;">${match.team2_name || match.team2}</div>
              <div class="score-big" style="font-size: 4rem;">${match.team2_score || 0}</div>
            </div>
          </div>
        `;
      }
    }

    function renderCricketDetails() {
      let html = '';

      // Innings scorecard (if available)
      if (matchData.innings && matchData.innings.length > 0) {
        matchData.innings.forEach((inning, idx) => {
          html += `
            <div style="background: white; border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: var(--shadow-sm);">
              <h3 style="margin-bottom: 1rem;">${idx + 1}${idx === 0 ? 'st' : 'nd'} Innings - ${inning.batting_team}</h3>
              <div style="font-size: 1.5rem; font-weight: 600; margin-bottom: 1rem;">
                ${inning.runs}/${inning.wickets} (${inning.overs} ov)
              </div>
            </div>
          `;
        });
      }

      // Extras
      if (matchData.wides || matchData.noballs) {
        html += `
          <div style="background: white; border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: var(--shadow-sm);">
            <h3 style="margin-bottom: 1rem;"><i class="fas fa-plus-circle"></i> Extras</h3>
            <div style="display: flex; gap: 2rem;">
              <span>Wides: <strong>${matchData.wides || 0}</strong></span>
              <span>No Balls: <strong>${matchData.noballs || 0}</strong></span>
              <span>Total: <strong>${(matchData.wides || 0) + (matchData.noballs || 0)}</strong></span>
            </div>
          </div>
        `;
      }

      return html;
    }

    function renderKabaddiDetails() {
      let html = '';

      // Half-wise scores
      if (matchData.halves && matchData.halves.length > 0) {
        html += `
          <div style="background: white; border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: var(--shadow-sm);">
            <h3 style="margin-bottom: 1rem;"><i class="fas fa-clock"></i> Half-wise Scores</h3>
            <table style="width: 100%; text-align: center;">
              <thead>
                <tr>
                  <th>Half</th>
                  <th>${matchData.team1_name || 'Team 1'}</th>
                  <th>${matchData.team2_name || 'Team 2'}</th>
                </tr>
              </thead>
              <tbody>
                ${matchData.halves.map(h => `
                  <tr>
                    <td>${h.half === 1 ? '1st' : '2nd'} Half</td>
                    <td><strong>${h.team1_score}</strong></td>
                    <td><strong>${h.team2_score}</strong></td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        `;
      }

      return html;
    }

    function renderVolleyballDetails() {
      let html = '';

      // Set-wise scores
      if (matchData.sets && matchData.sets.length > 0) {
        html += `
          <div style="background: white; border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: var(--shadow-sm);">
            <h3 style="margin-bottom: 1rem;"><i class="fas fa-list-ol"></i> Set-wise Scores</h3>
            <table style="width: 100%; text-align: center;">
              <thead>
                <tr>
                  <th>Set</th>
                  <th>${matchData.team1_name || 'Team 1'}</th>
                  <th>${matchData.team2_name || 'Team 2'}</th>
                  <th>Winner</th>
                </tr>
              </thead>
              <tbody>
                ${matchData.sets.map(s => `
                  <tr>
                    <td>Set ${s.set}</td>
                    <td><strong>${s.team1}</strong></td>
                    <td><strong>${s.team2}</strong></td>
                    <td style="color: var(--volleyball-primary);">${s.winner}</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        `;
      }

      return html;
    }

    function capitalize(str) {
      return str ? str.charAt(0).toUpperCase() + str.slice(1) : '';
    }

    // Auto-refresh for live matches
    setInterval(() => {
      if (matchData && matchData.status === 'live') {
        loadMatchDetails();
      }
    }, 10000);
  </script>
</body>

</html>