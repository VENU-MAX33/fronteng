<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Live Matches - Sports Arena Hub</title>
    <link rel="stylesheet" href="../style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
</head>

<body>

    <header>
        <div class="container">
            <nav>
                <div class="logo">
                    <div class="logo-icon">ğŸ†</div>
                    Sports Arena Hub
                </div>
                <div class="nav-links">
                    <a href="index.html">Home</a>
                    <a href="register.html">Register Team</a>
                    <a href="live_score.html" class="active">Live Matches</a>
                    <a href="achievements.html">Achievements</a>
                    <a href="admin.html">ğŸ® Host Match</a>
                </div>
            </nav>
        </div>
    </header>

    <section class="hero" style="padding: 4rem 2rem;">
        <div class="container">
            <h1>ğŸ“º Live Matches & Results</h1>
            <p>Watch real-time scores and explore match history</p>
        </div>
    </section>

    <section class="container">
        <!-- Search Bar -->
        <div class="search-bar" style="max-width: 600px; margin: 0 auto 2rem;">
            <input type="text" id="searchInput" placeholder="Search matches by team name..." onkeyup="filterMatches()">
            <button class="btn" onclick="filterMatches()"><i class="fas fa-search"></i></button>
        </div>

        <!-- Tabs -->
        <div class="tabs" style="justify-content: center;">
            <button class="tab active" onclick="showTab('live')">ğŸ”´ Live Matches</button>
            <button class="tab" onclick="showTab('completed')">âœ… Completed</button>
            <button class="tab" onclick="showTab('all')">ğŸ“‹ All Matches</button>
        </div>

        <!-- Live Matches -->
        <div id="liveTab" class="tab-content active">
            <div id="liveMatches" class="card-grid" style="margin-top: 2rem;">
                <div class="text-center" style="grid-column: 1 / -1; padding: 3rem;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: var(--text-light);"></i>
                    <p style="color: var(--text-light); margin-top: 1rem;">Loading live matches...</p>
                </div>
            </div>
        </div>

        <!-- Completed Matches -->
        <div id="completedTab" class="tab-content">
            <div id="completedMatches" class="card-grid" style="margin-top: 2rem;">
                <div class="text-center" style="grid-column: 1 / -1; padding: 3rem;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: var(--text-light);"></i>
                    <p style="color: var(--text-light); margin-top: 1rem;">Loading completed matches...</p>
                </div>
            </div>
        </div>

        <!-- All Matches -->
        <div id="allTab" class="tab-content">
            <div id="allMatches" class="card-grid" style="margin-top: 2rem;">
                <div class="text-center" style="grid-column: 1 / -1; padding: 3rem;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: var(--text-light);"></i>
                    <p style="color: var(--text-light); margin-top: 1rem;">Loading matches...</p>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <p style="font-size: 1.5rem; margin-bottom: 1rem;">ğŸ†</p>
            <p><strong>Sports Arena Hub</strong></p>
            <p>Â© 2026 Sports Arena Hub â€¢ Made with â¤ï¸ for Sports Lovers</p>
        </div>
    </footer>

    <!-- Appwrite SDK -->
    <script src="https://cdn.jsdelivr.net/npm/appwrite@latest"></script>
    
    <!-- Configuration & Setup -->
    <script src="../js/config.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/appwrite-sdk.js"></script>
    <script src="../js/live-score-handler.js"></script>
    <script>
        let allMatchesData = [];

        document.addEventListener('DOMContentLoaded', () => {
            if (typeof updateNavAuth === 'function') updateNavAuth();
            loadMatches();
        });

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(`${tabName}Tab`).classList.add('active');
        }

        async function loadMatches() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/matches`);

                if (response.ok) {
                    allMatchesData = await response.json();
                    renderMatches();
                } else {
                    throw new Error('Failed to load');
                }
            } catch (error) {
                console.error('Error loading matches:', error);
                showNoMatches();
            }
        }

        function renderMatches() {
            const liveMatches = allMatchesData.filter(m => m.status === 'live');
            const completedMatches = allMatchesData.filter(m => m.status === 'completed');

            document.getElementById('liveMatches').innerHTML = renderMatchCards(liveMatches, 'live');
            document.getElementById('completedMatches').innerHTML = renderMatchCards(completedMatches, 'completed');
            document.getElementById('allMatches').innerHTML = renderMatchCards(allMatchesData, 'all');
        }

        function renderMatchCards(matches, type) {
            if (matches.length === 0) {
                return `
          <div class="text-center" style="grid-column: 1 / -1; padding: 3rem; color: var(--text-light);">
            <div style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;">
              ${type === 'live' ? 'ğŸŸï¸' : 'ğŸ“‹'}
            </div>
            <p>${type === 'live' ? 'No live matches right now' : 'No matches found'}</p>
            ${type === 'live' ? '<p style="font-size: 0.9rem;">Check back later or <a href="admin.html" style="color: var(--accent);">host a match</a></p>' : ''}
          </div>
        `;
            }

            return matches.map(match => `
        <div class="match-card ${match.status}" onclick="viewMatch('${match.id}')">
          <div class="match-header">
            <span class="match-badge ${match.status === 'live' ? 'badge-live' : 'badge-completed'}">
              ${match.status === 'live' ? 'ğŸ”´ Live' : 'âœ… Completed'}
            </span>
            <span class="match-badge badge-${match.sport}">${capitalize(match.sport)}</span>
          </div>
          <div class="match-teams">${match.team1_name || match.team1} vs ${match.team2_name || match.team2}</div>
          <div class="match-score ${match.status === 'live' ? 'highlight' : ''}">${formatScore(match)}</div>
          ${match.result ? `<div style="font-size: 0.9rem; color: var(--text-light); margin-top: 0.5rem;">${match.result}</div>` : ''}
        </div>
      `).join('');
        }

        function formatScore(match) {
            if (match.sport === 'cricket') {
                if (match.status === 'live') {
                    return `${match.runs || 0}/${match.wickets || 0} (${match.overs || '0.0'} ov)`;
                }
                return match.result || 'Match Completed';
            } else if (match.sport === 'kabaddi') {
                return `${match.team1_score || 0} - ${match.team2_score || 0}`;
            } else {
                return `${match.team1_score || 0} - ${match.team2_score || 0}`;
            }
        }

        function capitalize(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        function viewMatch(matchId) {
            window.location.href = `match-details.html?id=${matchId}`;
        }

        function filterMatches() {
            const query = document.getElementById('searchInput').value.toLowerCase();

            if (!query) {
                renderMatches();
                return;
            }

            const filtered = allMatchesData.filter(m =>
                (m.team1_name || m.team1 || '').toLowerCase().includes(query) ||
                (m.team2_name || m.team2 || '').toLowerCase().includes(query)
            );

            const liveFiltered = filtered.filter(m => m.status === 'live');
            const completedFiltered = filtered.filter(m => m.status === 'completed');

            document.getElementById('liveMatches').innerHTML = renderMatchCards(liveFiltered, 'live');
            document.getElementById('completedMatches').innerHTML = renderMatchCards(completedFiltered, 'completed');
            document.getElementById('allMatches').innerHTML = renderMatchCards(filtered, 'all');
        }

        function showNoMatches() {
            const noMatchesHtml = `
        <div class="text-center" style="grid-column: 1 / -1; padding: 3rem; color: var(--text-light);">
          <div style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;">ğŸŸï¸</div>
          <p>No matches found</p>
          <p style="font-size: 0.9rem;">Be the first to <a href="admin.html" style="color: var(--accent);">host a match</a></p>
        </div>
      `;
            document.getElementById('liveMatches').innerHTML = noMatchesHtml;
            document.getElementById('completedMatches').innerHTML = noMatchesHtml;
            document.getElementById('allMatches').innerHTML = noMatchesHtml;
        }

        // Auto-refresh live matches every 30 seconds
        setInterval(() => {
            if (document.getElementById('liveTab').classList.contains('active')) {
                loadMatches();
            }
        }, 30000);
    </script>
</body>

</html>